# 1장 웹 브라우저가 메세지를 만든다

핵심 포인트
- 브라우저의 동작을 처음 추적함

- 브라우저는 OS에 의뢰하여 네트워크를 제어한다.

 

동작순서
1. HTTP 리퀘스트 메시지를 작성한다.

2. 웹 서버의 IP 주소를 DNS 서버에 조회한다.

3. 전 세계의 DNS 서버가 연대한다.

4. 프로토콜 스택에 메시지 송신을 의뢰한다.

--- 

## 1. HTTP 리퀘스트 메시지를 작성한다.

<br> 

### 1. 탐험 여행은 URL 입력부터 시작한다.

- URL(Uniform Resource Locator)은 http 뿐 아니라 ftp, file 등 여러 종류가 있다.

- 브라우저는 여러 클라이언트 기능을 가지고 있는 복합적인 소프트웨어이기 때문에, 여러 프로토콜이 존재한다. 따라서, 웹 서버 액세스 용이 아니라 FTP, 메일의 클라이언트 기능도 할 수 있다.

- URL에 엑세스 대상에 따라서 여러 정보를 담는다.

<br> 

### 2. 브라우저는 먼저 URL을 해독한다.

- 브라우저가 처음 하는 일은 웹 서버에 보내는 요청의 메시지를 작성하기 위해서 URL을 해독하는 것이다.

- 웹 브라우저가 URL을 해독하는 흐름 

  ex) http://www.lab.cyber.co.kr/dir/file1.html => 프로토콜(http) + 구분(//) + 웹서버명(www.lab.cyber.co.kr) + 디렉토리명(dir) + 파일명(file1.html)

<br>  

### 3. 파일명을 생략한 경우
- /로 끝나는 URL의 경우 해당 디렉토리에서의 기본 파일을 의미한다.

- 서버측에 기본 파일을 설정하여 생략할 수 있다. (index.html, default.htm)

<br>  

### 4. HTTP의 기본 개념

- URL을 해독하면 어디에 액세스 할 지 판단된다. 그러고 나면 HTTP 프로토콜을 사용하여 웹 서버에 엑세스 한다.

- HTTP 프로토콜은 클라이언트와 서버가 주고받는 메세지의 내용이나 순서를 정한 것이다. 

- HTTP 프로토콜의 요청 메세지가 담고 있는 내용 : 
    * 무엇을 : URI(Uniform Resource Identifier, 액세스 대상을 통칭). 페이지 데이터를 저장한 경로나 URL 을 그대로 사용할 수 있다.
    * 어떻게 : 메소드로, 웹서버에 어떤 동작을 하고 싶은지 전달 (GET, PUT, POST..)

-  응답 메세지
    * 스테이터스 코드 : 실행 경과내 대한 코드 (404, 503, 200 ..)
    * 헤더 파일
    * 페이지의 데이터

<!--TODO HTTP 기본 개념 이미지 첨부 -->

<br>  

### 5. HTTP 리퀘스트를 만든다

- 브라우저는 URL 을 해독하고 이것을 바탕으로 요청 메시지 포맷에 맞게 메시지를 만든다.

- 요청 메시지
    * 첫번째 행 (리퀘스트 라인) : 메소드 + 공백 + URI + 공백 + HTTP 버전
        리퀘스트의 전반적인 개요
    * 두번째부터 공백까지 (메세지 헤더) : 필드명:필드값
        부가적인 자세한 정보. 날짜, 데이터 종류, 언어, 압축 형식 등등
    * 공백 라인 이후 (메세지 본문) : 메세지 본문
        송신할 데이터를 메세지 본문에 기재. 주로 폼 데이터를 POST 메소드로 보낼 때.

<br> 

<!-- 요청 메시지의 예시 (출처: https://images.app.goo.gl/z89SC2hKxgVFFuH89) -->

<br> 

### 6. 리퀘스트 메시지를 보내면 응답이 되돌아온다

- 기본적으로 첫번째 행을 제외하고 요청 메세지와 비슷한 형태를 지닌다.

- 응답 메세지
    * 첫번째 행 : status code + status 응답 문구 ( ex. 404 Not Found)

- 응답이 오면 메세지를 추출해서 화면에 표시한다.

- 추가적으로 이미지나 영상을 담고 있는 경우 응답 문장에 tag를 추가하여 명시한다.

~~~ 
#예시
<img src="image1.jpg" /> 
~~~

- 페이지가 영상을 포함하거나 다른 태그가 있다면 해당 태그를 비워두고 다른 문장들을 표시한다. 이후 다시 한 번 웹 서버에 태그에 쓰여있는 파일을 읽어와서 비워둔 공백에 표시한다.

- 여러가지 요청을 보내는데, 웹 서버 측에서는 이게 한 개의 페이지인지, 아니면 각각 별도의 페이지인지 신경쓰지 않는다. 단순히 한 개의 요청에 대해 한 개의 응답을 보내는 것 뿐이다.

---

## 2. 웹 서버의 IP 주소를 DNS 서버에 조회한다.

<br> 

### 1. IP 주소의 기본

- HTTP 메시지를 만들고 이것을 OS에 의뢰하여 웹 서버에게 송신함.

- 브라우저는 메시지를 네트워크에 송출하는 기능이 없어서 OS에 송신한다.

- OS에 송신을 의뢰할 때는 IP 주소로 상대를 지정해야 한다.

- 도메인 명에서 IP주소를 조사해야 한다.
브라우저가 담당하는 일 → URL 해독, HTTP 메세지 만들기
OS가 담당하는 일 → 메세지를 네트워크로 송출
따라서 브라우저가 위 업무는 OS에 위임하여 메세지를 송신한다.
이때 URL에서 해석한 도메인명의 IP 주소를 조사해야 한다.

 https://yjksw.github.io/one-percent-network-1/

TCP/ IP의 개념

- 서브넷이라는 작은 네트워크를 라우터로 접속하여 전체 네트워크가 만들어진다.

- 서브넷: 허브에 몇 대의 PC가 접속된 것

- IP 주소: 네트워크 번호 (~동) + 호스트 번호 (~번지)

- 송신 측 메시지 보냄 -> 서브넷 안에 있는 허브가 운반 -> 가장 가까운 라우터까지 도착 -> 라우터가 메시지 상태를 확인하여 다음 라우터 판단

- 실제 IP 주소는 32비트의 디지털 데이터. 8비트씩 점으로 구분하여 10진수로 표기함

- IP 주소의 규칙에서는 네트워크 번호와 호스트 번호 두 가지를 합쳐서 32비트로 한다는 것만 결정되고 내용은 결정되어 있지 않음

- 사용자가 이 내용을 직접 결정할 수 있는데 그것을 넷마스크라고 한다.

- 넷마스크: 넷마스크가 1인 부분은 네트워크 번호를 나타내고, 넷마스크가 0인 부분은 호스트 번호를 나타낸다. IP 주소와 같이 8비트씩 구분하여 표기할 수도 있는데 너무 길어져서 한 부분의 비트 수를 10진수로 나타내고 IP 주소의 오른쪽에 병기할 수도 있다.

- 호스트 번호 부분이 모두 0인 IP 주소는 각각의 기기를 나타내는 것이 아니라 서브넷 자체를 나타낸다.

- 호스트 번호 부분이 모두 1이면 (255) 서브넷에 있는 기기 전체에 패킷을 보내는 브로드캐스트를 나타낸다.

<br>  

### 2. 도메인명과 IP 주소 구분하여 사용하는 이유

- IP 주소를 기억하고 브라우저에서 입력을 해도 동작은 되지만, 기억하기 어렵기 때문에 도메인 명을 쓰도록 한다.

- 도메인명 만으로 네트워크 통신을 하게 된다면 주소에 대한 바이트가 균일하지 않고 지나치게 클 수 있다. 라우터가 부하되어 네트워크의 속도가 느려진다.

- 따라서 사용자는 도메인명만 기억하면 해당 IP 주소를 알아서 찾아주는 DNS를 사용한다.

<br>  

### 3. Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다

- 가장 가까운 DNS 서버에 도메인 네임을 넘기고 그 IP를 알려달라고 하면 된다.

 

브라우저가 DNS 서버를 조회하는 방법

- DNS 리졸버 (리졸버): DNS 서버에 대해서 클라이언트로 동작하는 것. DNS 클라이언트

- 네임 리졸루션: DNS의 원리를 사용하여 IP 주소를 조사하는 것

- 리졸버는 Socket 라이브러리에 들어있는 부품화한 프로그렘이다.

- Socket 라이브러리: OS에 포함되어 있는 네트워크의 기능을 애플리케이션에서 호출하기 위한 라이브러리.

DNS 동일하게 요청 메세지 + 응답 메세지의 구조로 데이터를 찾아내는 것이다.
DNS 서버에 요청 메세지를 보내어 도메인명을 의뢰하는 DNS 클라이언트는 DNS 리졸버이다.
DNS resolution → DNS 원리로 IP 주소를 조사하는 것 (DNS 리졸버가 수행함)
DBS 리졸버는 Socket 라이브러리에 내장된 프로그램이다.
Socket 라이브러리에는 네트워크 기능과 관련된 프로그램이 집합해 있다.

<br>  

### 4. 리졸버를 이용하여 DNS 서버를 조회한다

- 브라우저 등의 애플리케이션을 만들 때 리졸버의 프로그램 (gethostbyname)을 사용하면 리졸버를 호출할 수 있음

- 리졸버를 호출하면 리졸버가 DNS 서버에 조회 메시지를 보내고, DNS 서버에서 응답 메시지가 돌아온다. 리졸버는 여기서 IP 주소를 추출하여 브라우저에서 지정한 메모리 영역에 넣어준다.

- Socket 라이브러리에 리졸버 메소드에 의뢰하고자 하는 도메인 명을 명시하면 IP 주소를 조회할 수 있다.

<br>  

###  5. 리졸버 내부의 작동

- 네트워크 애플리케이션 (현재 단계에서는 브라우저)이 리졸버를 호출하면 제어가 리졸버로 넘어간다.

- DNS 서버에 문의하기 위한 메시지를 만든다. (메시지는 바이너리 데이터로 표현)

- 메시지 송신 동작은 리졸버가 스스로 실행하는 것이 아니라 OS의 내부에 포함된 프로토콜 스택을 호출하여 실행을 의뢰한다. (리졸버도 브라우저와 마찬가지로 네트워크에 대해 데이터를 송/수신하는 기능이 없기 때문)

- 프로토콜 스택에서 메시지를 보내는 동작을 실행하여 LAN 어댑터를 통해 메시지가 DNS 서버를 향해 송신된다.

- 메시지가 DNS 서버에 도착하고 DNS 서버는 해당 서버를 찾아서 응답 메시지에 써서 반환을 한다.

- 메시지 송신의 역순으로 메시지를 받아오고, 애플리케이션에 지정된 메모리 주소에 해당 IP 주소를 할당한다.

- DNS 서버에 메시지를 송신할 때도 DNS 서버의 IP 주소가 필요하다. 단 이것은 컴퓨터에 미리 설정되어 있다.

어플리케이션(브라우저)에서 리졸버를 호출하면서 어플리케이션은 잠시 대기한다. (리졸버로 제어가 넘어가 실행된다. 이때부터 실행주체는 Socket 라이브러리의 리졸버이다)
DNS 서버에 응답 메세지를 만들어 보낸다.
메세지 송신 동작은 OS의 프로토콜 스택이 수행한다. LAN 어댑터를 경유하여 목표서버에 메세지가 전달된다.
DNS 서버가 해당 메세지를 해석하여 결과를 찾는다.
응답이 오면 프로토콜 스택 → 리졸버가 내용을 해독하여 IP 주소 추출 → 어플리케이션에 주소전달 하는 단계를 밟는다.
DNS 서버 주소 정보는 ?
TCP/IP 설정 항목으로 컴퓨터에 미리 설정되어 있다.
 