# 3장 케이블의 앞은 LAN 기기였다 

핵심 포인트
- 패킷은 LAN 어댑터를 지나 스위칭 허브, 라우터를 통해 인터넷과 연결된다

동작순서

- LAN 어댑터에서 패킷 송신

- 케이블을 통해 신호 전달

- 스위칭 허브와 라우터 등의 중계 장치를 지나 인터넷과 연결된다

---

## 1. 케이블과 리피터, 허브 속을 신호가 흘러간다

<br>

### 1. 하나하나의 패킷이 독립된 것으로 동작한다.

- 컴퓨터에서 송신된 패킷은 케이블로 흘러가 중계 장치를 경유해서 목적지에 도착한다.

- 중계 장치는 데이터의 내용을 보지 않고 헤더에 적힌 정보만 보고 중계한다.

- 내용을 보지 않으므로, 제어 정보의 내용이 패킷을 운반하는 동작에 영향을 미치지 않는다.

- 따라서 모든 패킷은 아무 관련도 없는 것으로 간주하고 목적지를 향해 중계된다.

<br>

### 2. LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다

- LAN 어댑터의 PHY(MAU)회로에서 전기 신호가 나가 케이블에 흘러 리피터 허브의 커넥터 부분에 도착한다.

- PHY(MAU) : Physical Layer Device 로 100mb/s 이상의 이더넷 회로의 호칭

- 송출된 신호는 케이블이 길어질 수록 신호가 약해지며, 허브에 도착할 때 약해진 신호로 잘못 판독이 되면 통신 오류의 원인이 될 수 있다.

<br>

### 3. '꼼'은 잡음을 방지하기 위한 방법이다.

- LAN 케이블로 트위스트 페어 케이블를 사용하는데, 이것은 선을 꼬게 되면서 전자파에 의한 잡음을 상쇄한다.

- 잡음은 케이블 주위에서 발생하는 전자파로 인해 발생하는데, 신호선을 마주 꼬면 잡음에서 생긴 전류가 상쇄되어 잡음에 의한 전류가 약해지는 원리를 사용한다.

<br>

### 4. 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다

- 신호가 리피터 허브에 도착하면 LAN 전체에 신호가 흩어진다.

- 리피터 허브에서 PHY 회로의 수신부에 도달한 신호는 리피터 회로로 들어가는데, 리피터 회로의 기본은 들어오는 신호를 리피터 허브의 커넥터 부분에 뿌리는 데 있다. 

- 신호를 수신한 기기는 맨 앞의 MAC 헤더에 쓰인 수신처 MAC 주소를 확인하고 자신이 아니면 무시한다.

- 이 다음 스위칭 허브, 라우터, 서버 등에 도착해서 디지털 데이터로 변환되고, FCS를 검사하는 곳에서 오류가 나면 패킷을 폐기한다.

<br>

---

# 2. 스위칭 허브의 패킷 중계 동작

<br>

### 1. 스위칭 허브는 주소 테이블로 중계한다

- 스위칭 허브는 이더넷의 패킷을 그대로 목적지를 향해 중계하도록 만들어져 있다.

- 트위스트 페어 케이블에서 흘러온 전기 신호가 PHY(MAU)회로를 거쳐 MAC 회로로 들어온다.

- MAC 회로에서 디지털 데이터(0101로 이루어진 데이터)로 변환되고 FCS를 대조하여 오류 유무를 검사하여 문제가 없다면 메모리 버퍼에 저장한다.

- 스위치 허브의 각 포트는 PC의 LAN 어댑터와 거의 같다

- 하지만 LAN 어댑터와 다른점은 MAC 주소가 할당되어 있지 않다. 자기에게 할당된 패킷을 걸러서 받는 것이 아니라 모든 패킷을 수신하기 때문에 자신에게 부여된 MAC 주소가 필요 없다.

- 패킷을 버퍼 메모리에 저장한 후 MAC 주소표에 수신한 패킷의 수신처 MAC 주소와 일치하는 정보가 있는지 확인한다. 

- 존재한다면 해당 포트 번호로 패킷을 보낸다. 해당 포트가 송신처 포트 번호가 된다.

- 스위치 회로는 격자 모양의 배치로 교점에 스위치가 있어 독립적으로 개폐를 제어할 수 있기 때문에 신호가 중복되지 않으면 복수의 신호를 동시에 흘릴 수 있다.

- 실제로 패킷을 송신하는 PHY(MAU) 회로에서 케이블로 신호가 흘러가는데 이때는 이더넷의 규칙에 따라 아무도 송신하고 있지 않는 것을 확인하고 디지털 데이터를 신호로 변환하여 송신한다.

- LAN 어댑터와 마찬가지로 동시에 수신을 하게 되면 재밍 신호를 보낸 후 기다렸다가 재송신한다.

<br>

### 2. MAC 주소 테이블을 등록 및 갱신한다

- 스위칭 허브는 패킷을 중계할 때 MAC 주소표의 내용을 갱신해야 한다.

- 갱신 동작
    * 패킷 수신 시 송신처 MAC 주소를 조사하여 수신한 입력 포트와 함께 주소표에 등록 (한번이라도 패킷을 송신하면 MAC 주소가 주소표에 등록됨)
    * 일정 시간이 지나면 MAC 주소표 정보는 삭제

- 잘못된 주소로 인해 패킷 통신 동작에 오류가 생기면 스위칭 허브를 리셋하여 MAC 주소를 초기화시키고 다시 주소가 등록되도록 하면 된다.

- MAC 주소표의 내용은 자동으로 스위칭 허브가 MAC 주소를 등록, 삭제, 리셋하므로 수동으로 갱신 및 등록 할 필요가 없다.

<br>

### 3. 예외적인 동작

- 스위칭 허브는 수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기한다.

- 최초이거나 삭제된 이후라서 MAC 주소표에 MAC 주소가 등록되어 있지 않은 경우, 패킷을 수신한 포트를 제외한 모든 포트에서 패킷을 송신한다. 이후 응답이 오면 해당 MAC 주소가 주소표에 등록이 되므로 그 다음 부터는 전체에게 보내지 않아도 된다.

- 수신처 MAC 주소가 브로드캐스트 주소인 경우 수신 포트를 제외하고 모든 포트에서 패킷을 송신한다.

<br>

### 4. 전이중 모드에서 송신과 수신을 동시에 실행한다

- 전이중 모드 : 송신과 수신을 동시에 실행할 수 있는 모드. 신호의 충돌을 검출하는 회로를 무효화 한다.

- 스위칭 허브는 전이중 모드로, 스위칭 허브의 포트, PHY(MAU), MAC 회로 내부가 모두 송신과 수신이 나뉘어져 있다.

<br>

### 5. 최적의 전송 속도로 보내는 자동 조정

- 자동 조정 : 동작 모드 뿐 아니라 상대의 전송 속도를 검출하여 전송 속도도 자동으로 전환하는 기능

- 접속 상대가 전이중 모드를 지원하는지 검출하여 동작 모드를 자동으로 전환하고 상대의 속도도 검출한다.

<br>


### 6. 스위칭 허브는 복수의 중계 동작을 동시에 실행한다

- MAC 주소가 존재하는 포트 이외의 포트는 빈 포트가 되어 송신 동작을 하지 않는다.

- 이 비어있는 포트에 별도의 패킷을 흘려 동시에 여러개의 패킷을 중계할 수 있다.