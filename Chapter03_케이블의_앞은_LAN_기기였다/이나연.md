## STORY 01 | 케이블과 리피터, 허브 속을 신호가 흘러간다

### 1. 하나하나의 패킷이 독립된 것으로 동작한다

컴퓨터에서 송신된 패킷은 허브나 라우터라는 중계 장치에 의해 중계되어 목적지를 향해 진행.

패킷의 헤더에 기록된 제어 정보와 중계 장치의 내부에 있는 중계 대상을 등록한 표로 목적지를 판단하고 목적지에 가까워지도록 하여 패킷을 중계하는 형태.

중계 장치는 데이터 부분을 보지 않고 패킷을 중계

→ 모든 패킷은 아무 관련도 없는 별개의 것으로 간주하고 목적지를 향해 중계

### 2. LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다

송출한 신호는 그대로의 모습으로 허브에 도착하는 것이 아니라 허브에 도착할 때는 신호가 약해져 있음.

잡음의 영향까지 더해지면 매우 심각하게 변형됨. 약해진 신호가 더욱 변형되면 0과 1을 잘못 판독할 수 있음

→ 이것이 통신 오류의 원인이 됨.

### 3. ‘꼼’은 잡음을 방지하기 위한 방법이다

LAN 케이블로 사용하는 트위스트 페어 케이블(꼰 선쌍)에는 잡음의 영향을 억제하는 대책을 마련

→ 꼼 (신호선을 마주 꼬아서 잡음을 막을 수 있음)

잡음의 원인

- 케이블의 주위에서 발생하는 전자파
- 케이블의 주위에 전자파가 있으면 신호와는 다른 전류가 케이블 안에 흐름
- 신호도 전압에 의해 생기는 일종의 전류이므로 잡음에 의해 생기는 전류와 같음
- 신호와 잡음의 전류가 뒤섞여서 신호의 파형이 변형됨

전자파의 종류

- 모터, 형광등, CRT 모니터와 같은 기기에서 누설되는 전자파

→ 케이블의 밖에서 오는 것으로, 선을 꼼으로써 막을 수 있음

- 같은 케이블 안의 인접한 신호선에서 누설되는 전자파

→ 신호선 안에는 신호라는 전류가 흐르므로 전류에 의해 주위에 전자파가 생기고, 이것이 다른 신호선에 대한 잡음이 됨 (크로스토크)

대책: 신호선을 마주 꼬는 것

신호선 사이의 거리를 유지하기 위해 신호선 사이에 구분판을 넣거나 전자파를 차단하기 위해 금속성의 실드라는 피복을 입힐 수도 있음

### 4. 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다

신호가 리피터 허브에 도달하면 LAN 전체에 신호가 흩어짐.

리피터 허브는 연결된 케이블 전부에 신호를 송신

리피터 회로의 기본은 신호를 그대로 뿌리는 것이므로 잡음의 영향을 받아 변형되고, 데이터가 변화한 것 같은 신호라도 그대로 흘려버림.

- 스위칭 허브, 라우터, 서버 등에 도달하여 디지털 데이터로 변환되고 FCS를 검사하는 곳에서 데이터 변화가 판명된 후 변화된 패킷은 폐기
- 데이터가 없어지지는 않음
- 프로토콜 스택의 TCP 담당 부분이 패킷을 다시 보냄

## STORY 02 | 스위칭 허브의 패킷 중계 동작

### 1. 스위칭 허브는 주소 테이블로 중계한다

스위칭 허브의 동작

- 커넥터와 PHY(MAU) 회로는 MDI-X로 접속되어 있고, 트위스트 페어 케이블에서 신호가 들어오면 PHY(MAU) 회로의 수신 부분에 들어감
- PHY(MAU) 회로에서 케이블을 흐르는 신호의 형식부터 공통의 신호 형식으로 변환한 후 신호는 MAC 회로로 들어감
- 디지털 데이터로 변환한 후 패킷의 맨 끝에 있는 FCS를 대조하여 오류의 유무를 검사하고, 문제가 없으면 버퍼 메모리에 저장
- 수신처 MAC 주소와 일치하는 것이 MAC 주소표에 등록되어 있는지 조사
- 수신한 패킷을 어느 포트에서 송신하면 좋을지 판단

스위칭 허브의 포트에서 MAC 회로에는 MAC 주소가 할당되어 있지 않음

스위치 회로

- 전자적으로 개폐를 제어할 수 있고, 이 전자적 개폐를 통해 신호가 흐르는 대상을 제어
- 포트 사이에 패킷을 운반할 떄, 이 회로에 패킷의 신호를 흘림
- 스위치 회로를 경유하여 송신측의 포트에 패킷을 운반하면 MAC 회로나 PHY(MAU) 회로가 송신 동작을 실행하고 케이블에 신호가 흘러감

스위칭 허브는 MAC 주소표에서 MAC 주소를 조사하고 해당하는 포트에서 신호를 송신

### 2. MAC 주소 테이블을 등록 및 갱신한다

스위칭 허브는 패킷을 중계할 때 MAC 주소표의 내용을 갱신하는 동작도 실행

갱신 동작

- 패킷을 수신했을 때 송신처 MAC 주소를 조사하고, 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표에 등록
- MAC 주소표에 등록한 정보는 일정 시간이 경과하면 삭제

MAC 주소표의 내용은 스위칭 허브 자체가 스스로 등록하거나 삭제하기 때문에 수동으로 등록 및 삭제할 필요 없음

### 3. 예외적인 동작

ex) 주소표에서 일치하는 행을 찾아냈을 때 주소표에 등록되어 있는 송신 포트가 패킷을 수신한 포트와 같다고 가정

스위칭 허브가 패킷을 중계하면 같은 패킷이 두 번 도착

스위칭 허브는 패킷을 수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기

수신처 MAC 주소가 브로드캐스트 주소인 경우에도 수신 포트를 제외하고 모든 포트에서 패킷을 송신

### 4. 전이중 모드에서 송신과 수신을 동시에 실행한다

스위칭 허브의 특징.. 송신과 수신을 동시에 실행할 수 있는 성질 (리피터 허브에는 X)

트위스트 페어 케이블의 신호선은 송신용과 수신용으로 나뉘어져 있으므로 송수신 도중에 신호가 충돌하지 않음. 리피터 허브를 사용하면 신호는 충돌하지 않는 셈

스위칭 허브의 전이중 모드는 송신과 수신을 동시에 진행함 (송신할 수 있는 데이터의 상한선도 높아서 성능이 좋음)

### 5. 최적의 전송 속도로 보내는 자동 조정

전이중 모드가 등장함에 따라 전이중 모드와 반이중 모드를 전환할 필요가 생김.

전이중 모드가 등장한 후 한동안 수동으로 동작 모드를 전환했지만 불편하기 때문에 나중에 동작 모들를 자동으로 전환하는 기능이 나옴

→ 자동 조정 이라고 함

- 접속한 상대가 전이중 모드를 지원하는지 검출하고 동작 모드를 자동으로 전환
- 상대의 전송 속도를 검출하여 전송 속도도 자동으로 전환

### 6. 스위칭 허브는 복수의 중계 동작을 동시에 실행한다

스위칭 허브는 수신처 MAC 주소의 기기가 존재하는 포트 이외에는 송신 동작을 실행하지 않으므로 다른 포트는 빈 상태가 됨.

여기에서 별도의 패킷을 흘릴 수 있으며, 동시에 여러 개의 패킷을 중계할 수 있음

리피터 허브 쪽은 들어온 신호를 모든 포트에서 뿌리므로 동시에 두 개 이상의 신호가 들어오면 패킷이 충돌하기 때문에 복수의 신호를 동시에 흘릴 수 없음

→ 기기 전체에서 중계할 수 있는 패킷의 수는 스위칭 허브쪽이 리피터 허브쪽보다 많음