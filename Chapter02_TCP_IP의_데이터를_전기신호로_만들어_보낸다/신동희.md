- 발표자 : 김유빈
- 서기 : 김희연
- 날짜 : 2023-08-10(목)
- 내용 : Chapter01 Story01~02

## Story01 ㅡ 소켓을 작성한다.

### 프로토콜 스택의 내부 구성

- OS에서는 브라우저에서 받은 메시지를 서버에 송출하는 동작에서 2가지가 있다.

  - 네트워크 제어용 소프트웨어: 프로토콜 스택
  - 네트워크 하드웨어: LAN 어댑터

- 프로토콜 스택 내부 구성

| APP - 네트워크 어플리케이션(브라우저, 메일러, 웹 서버, 메일 서버 등) <br/>Socket 라이브러리(리졸버 포함)                                                                                                                                                                                                  |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| OS - 프로토콜 스택(TCP + UDP / IP) <br/> TCP: 브라우저나 메일 등의 일반적인 어플이 데이터를 송/수신할 경우에 사용 <br/> UDP: DNS 서버에 대한 조회 등에서 짧은 제어용 데이터를 송/수신할 경우에는 UDP<br/> IP: 패킷을 통신 상대까지 운반하는 역할과 ICMP와 ARP라는 프로토콜을 다루눈 부분도 포함하고 있다. |
| 드라이버 SW - LAN드라이버(어댑터 제외)                                                                                                                                                                                                                                                                    |
| HW - LAN 어댑터                                                                                                                                                                                                                                                                                           |

### 소켓의 실체는 통신 제어용 제어 정보

- 소켓이란 개념적인 것이어서 어떠한 실체를 가진 것은 아니다.
- 한편 프로토콜 스택 내부에 제어 정보를 기록하는 메모리 영역이 있고, 여기에 IP주소, 포트 번호, 진행 상태 등이 존재한다.
- 소켓은 이 제어 정보라고 할 수 있다. 따라서 응답의 여부와, 요청을 보낸 경과 시간 등으로 제어를 할 수도 있다.
- 즉, 프로토콜 스택은 소켓의 제어 정보를 따라 움직인다.

## ![netstat명령](./신동희/1.PNG)

- 여기서 보이는 netstat의 명령어 결과의 하나하나의 행이 소켓이다.

### Socket을 호출했을 때의 동작

1. 소켓을 만든다. 따라서 생성된 소켓이 들어갈 자리(메모리)를 확보한다.
2. 제어 정보(소켓)을 메모리에 할당한다. 그리고 생성된 소켓을 식별한 디스크립터 고지.
3. 그리고 애플리케이션은 프로토콜 스택에 데이터 송/수신을 의뢰할 때 이 열쇠(디스크립터)만 가지고 호출한다. 이 열쇠(디스트립터)로 지정한 상자(소켓)을 열면 거기 안에 제어 정보가 담겨있기 때문이다.

## Story02 ㅡ 서버에 접속한다.

### 접속의 의미

- socket()을 호출하면 소켓이 생성되는데 클라이언트와 서버가 LAN선 같은 물리적인 연결 상태가 아니기 때문에 처음 생성한 소켓에는 아무것도 기록되어 있지 않다.
- 따라서 클라이언트 측 소켓에는 보낼 서버의 IP주소와 포트번호 등을 기재해야 하고
- 서버측 소켓에는 클라이언트로부터 송신 측의 IP와 포트번호를 받게 된다.
- 데이터 송/수신에는 이동되는 데이터를 일시적으로 저장하는 메모리 영역이 필요한데, 이를 '버퍼 메모리'하고 부른다.

### 맨 앞부분에 제어 정보를 기록한 헤더를 배치한다.

- 데이터를 송/수신 할 때는 데이터를 '패킷' 단위로 잘라서 보낸다.
- 이 패킷을 보낼 때 '헤더'를 같이 동행시켜서 보낸다.
- 이 헤더가 제어 정보이다. 이더넷이나 IP의 제어 정보, TCP의 제어 정보 등이 포함된다.
- 여기에는 송/수신 측의 포트 번호나 컨트롤 비트나 추가적으로 올 수 있는 옵션 등이 있다.
- socket(), connect(), write(), read(), close() 각 단계에서 대화할 때마다 이 제어정보가 부가된다.
- 제어 정보의 종류
  - 헤더에 기입되는 정보
  - 소켓(프로토콜 스택의 메모리 영역)에 기록되는 정보

### 접속 동작의 실체

- connect()를 호출하면서 서버측의 IP 주소와 포트 번호를 넘기면 TCP부분에 전달됨.
- 중요한 것은 송/수신처의 포트 번호이다. 이거로 상대측의 소켓을 지정할 수 있기 때문.
- 현재는 헤더에 있는 컨트롤 비트인 SYN을 1로 만들어서 접속한다고 보면 된다.
- 그렇게 되면 TCP부분에서 IP부분으로 넘어가면서 본격적으로 송/수신이 진행된다.
- (클라이언트) TCP - IP - IP - TCP (서버)
- 서버측에서 받은 데이터를 다시 클라이언트로 송신할 때 ACK컨트롤 비트를 1로 만든다. 이것은 패킷을 받을 것을 알리기 위함.
- 그리고 최종적으로 클라이언트에서 받았다고 끝이 아니라 잘 받았다는 TCP헤더를 반송하면 접속이 끝이 난다.
